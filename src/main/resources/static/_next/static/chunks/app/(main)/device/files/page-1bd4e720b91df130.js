(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2823],{2962:function(e,t,s){Promise.resolve().then(s.bind(s,330))},330:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var n=s(9268),l=s(6006),r=s(7537),o=s(7389),a=s(3429),i=s(8176),c=s(8298),d=s(4046),u=s(6008),m=s(4390),p=s(3702),x=s(2469),v=s(4319),h=s(9424),f=s(1196),g=s(9009),b=function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))},N=()=>{var e,t;let s=(0,l.useRef)(null),N=(0,u.useSearchParams)(),j=(0,u.useRouter)(),y=N.get("server"),[w,C]=(0,l.useState)(null),E=N.get("directory"),[S,k]=(0,l.useState)(null),[O,T]=(0,l.useState)(!1),[D,P]=(0,l.useState)([]),{isConnected:R,lastConnectionUpdate:L,sendMessageAndWaitForCondition:I,listenTillCondition:W}=(0,l.useContext)(r.WebsocketContext),[F,z]=(0,l.useState)(new Date),[M,U]=(0,l.useState)({}),[A,J]=(0,l.useState)(!1),[V,G]=(0,l.useState)(!1),[Z,H]=(0,l.useState)(!1),[_,B]=(0,l.useState)(null),[X,q]=(0,l.useState)(0),[K,Q]=(0,l.useState)(!1);function Y(){if(R&&w&&!K){if(!S){j.replace("/device/files?server=".concat(w,"&directory=/"));return}T(!0),Q(!0),I({type:"DEVICE-SCP-LIST",message:JSON.stringify({server:w,directory:S})},e=>"DEVICE-SCP-LIST"===e.type,5e3).then(e=>{if(e.message.success){let t=JSON.parse(e.message.files);P(t)}T(!1),Q(!1)}).catch(e=>{console.log(e),T(!1),Q(!1)})}}(0,l.useEffect)(()=>{y&&C(y),E&&k(E)},[y,E,R]),(0,l.useEffect)(()=>{let e=setInterval(()=>{R&&!K&&I({type:"DEVICE-DATA",message:w},e=>"DEVICE-DATA"===e.type).then(e=>{var t;(null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.exists)?(U(e.message),J(!1)):(J(!0),U({}))}).catch(()=>{})},250);return()=>clearInterval(e)},[R,w,K]),(0,l.useEffect)(()=>{Y()},[w,S,R]);let $=(0,l.useRef)(null),ee=async e=>{let{files:t}=e,n=b(),l=new FormData;l.append("server",w),l.append("directory",S),l.append("id",n),Array.from(t).forEach(e=>{l.append("files[]",e)}),T(!0),Q(!0);try{let e="TRANSFER-PROGRESS-"+n;W(t=>{var n,l,r;if((null==t?void 0:t.type)===e){let e=JSON.parse(t.message);return q(null!==(l=null==e?void 0:null===(n=e.percentage)||void 0===n?void 0:n.toFixed(0))&&void 0!==l?l:0),B(null!==(r=null==e?void 0:e.message)&&void 0!==r?r:"Unknown"),null!=e&&!!e.finished&&(s.current.show({severity:"success",summary:"Success",detail:"Files uploaded successfully"}),Y(),Q(!1),!0)}});let t=new XMLHttpRequest;t.open("POST","/api/upload",!0),t.upload.onprogress=e=>{if(e.lengthComputable){let t=e.loaded/e.total*100;q(t.toFixed(0)),B("Uploading to backend: ".concat(t.toFixed(0),"%"))}},t.onload=()=>{t.status>=200&&t.status<300?(q(100),B("Upload complete...")):(q(0),B("Upload failed to backend"),s.current.show({severity:"error",summary:"Error",detail:"File upload failed"}))},t.onerror=()=>{q(0),B("Upload error"),s.current.show({severity:"error",summary:"Error",detail:"File upload failed due to a network error"})},t.send(l)}catch(e){T(!1),Q(!1),console.error("Upload error:",e),s.current.show({severity:"error",summary:"Error",detail:e.message})}},et=e=>{q(50),H(!0);let t=b(),n=S+"".concat(S.endsWith("/")?"":"/").concat(e);B("Starting download..."),Q(!0),W(e=>{var n,l,r;if((null==e?void 0:e.type)==="TRANSFER-DOWNLOAD-PROGRESS-"+t){let t=JSON.parse(e.message);return q(null!==(l=null==t?void 0:null===(n=t.percentage)||void 0===n?void 0:n.toFixed(0))&&void 0!==l?l:0),B(null!==(r=null==t?void 0:t.message)&&void 0!==r?r:"Unknown"),null!=t&&!!t.finished&&(s.current.show({severity:"success",summary:"Success",detail:"Files downloaded successfully"}),Q(!1),!0)}}),fetch("/api/download?server=".concat(w,"&remoteFilePath=").concat(encodeURIComponent(n),"&id=").concat(t)).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.blob()}).then(e=>{let t=window.URL.createObjectURL(new Blob([e])),s=document.createElement("a");s.href=t,s.setAttribute("download",n.split("/").pop()),document.body.appendChild(s),s.click(),s.parentNode.removeChild(s)}).catch(e=>{console.error("There was a problem with the download:",e),Q(!1),B("Download failed: "+(null==e?void 0:e.message)),q(-1)})},es=(e,t)=>{q(0),t()};return(0,n.jsxs)("div",{className:"grid fadeIn",children:[(0,n.jsx)(d.F,{ref:s}),(0,n.jsx)(m.V,{header:"Machine Discovery Failed",modal:!1,visible:A,position:"top-right",style:{width:"50vw"},onHide:()=>{A&&J(!1)},closable:!1,draggable:!0,resizable:!1,children:(0,n.jsxs)("p",{className:"m-0",children:["The machine with the server name ",(0,n.jsx)("strong",{children:w})," was not found on the network running XCASTER. Please check your network connection, verify the machine is on and try again later."]})}),(0,n.jsx)(m.V,{maximizable:!0,style:{width:"80vw",height:"60vh"},visible:V,resizable:!1,onHide:()=>{G(!1)},children:(0,n.jsxs)("div",{children:[(0,n.jsx)(h.u,{target:".custom-choose-btn",content:"Choose",position:"bottom"}),(0,n.jsx)(h.u,{target:".custom-upload-btn",content:"Upload",position:"bottom"}),(0,n.jsx)(h.u,{target:".custom-cancel-btn",content:"Clear",position:"bottom"}),(0,n.jsx)(f.p,{disabled:K||O,ref:$,multiple:!0,maxFileSize:1e8,customUpload:!0,uploadHandler:ee,onClear:()=>{q(0)},headerTemplate:e=>{let{className:t,chooseButton:s,uploadButton:l,cancelButton:r}=e;return(0,n.jsxs)("div",{className:t,style:{backgroundColor:"transparent",display:"flex",alignItems:"center"},children:[s,l,r]})},itemTemplate:(e,t)=>(0,n.jsxs)("div",{className:"flex align-items-center flex-wrap",children:[(0,n.jsx)("div",{className:"flex align-items-center",style:{width:"40%"},children:(0,n.jsxs)("span",{className:"flex flex-column text-left ml-3",children:[e.name,(0,n.jsx)("small",{children:new Date().toLocaleDateString()})]})}),(0,n.jsx)(a.V,{value:t.formatSize,severity:"warning",className:"px-3 py-2"}),(0,n.jsx)(p.z,{type:"button",icon:"pi pi-times",className:"p-button-outlined p-button-rounded p-button-danger ml-auto",onClick:()=>es(e,t.onRemove)})]}),emptyTemplate:()=>(0,n.jsxs)("div",{className:"flex align-items-center flex-column",children:[(0,n.jsx)("i",{className:"pi pi-image mt-3 p-5",style:{fontSize:"5em",borderRadius:"50%",backgroundColor:"var(--surface-b)",color:"var(--surface-d)"}}),(0,n.jsx)("span",{style:{fontSize:"1.2em",color:"var(--text-color-secondary)"},className:"my-5",children:"Drag and drop files here"})]}),chooseOptions:{icon:"pi pi-fw pi-images",iconOnly:!0,className:"custom-choose-btn p-button-rounded p-button-outlined"},uploadOptions:{icon:"pi pi-fw pi-cloud-upload",iconOnly:!0,className:"custom-upload-btn p-button-success p-button-rounded p-button-outlined"},cancelOptions:{icon:"pi pi-fw pi-times",iconOnly:!0,className:"custom-cancel-btn p-button-danger p-button-rounded p-button-outlined"}}),X>0&&(0,n.jsxs)("div",{style:{marginTop:"20px"},children:[(0,n.jsx)(g.k,{value:X}),(0,n.jsx)("div",{children:_})]})]})}),(0,n.jsxs)(m.V,{footer:()=>(0,n.jsx)(p.z,{label:"Close",onClick:()=>H(!1)}),maximizable:!1,closable:!1,draggable:!1,style:{width:"80vw"},onHide:()=>H(!1),visible:Z,children:[(0,n.jsx)("h5",{children:_}),(0,n.jsx)(g.k,{mode:-1===X?"indeterminate":"determinate",value:X})]}),(0,n.jsx)("div",{className:"col-12 lg:col-6 sm:col-4 xl:col-3",children:(0,n.jsxs)("div",{className:"card mb-0",children:[(0,n.jsxs)("div",{className:"flex justify-content-between mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"block text-500 font-medium mb-3",children:"Backend Status"}),(0,n.jsx)("div",{className:"text-900 font-medium text-xl "+(R?"text-green-600":"text-red-600 animate-pulse"),children:R?"Connected":"Disconnected"})]}),(0,n.jsx)("div",{className:"flex align-items-center justify-content-center bg-blue-100 border-round",style:{width:"2.5rem",height:"2.5rem"},children:(0,n.jsx)("i",{className:"pi pi-chevron-circle-up text-blue-500 text-xl"})})]}),(0,n.jsx)(o.Z,{date:L})]})}),(0,n.jsx)("div",{className:"col-12 lg:col-6 sm:col-4 xl:col-3",children:(0,n.jsxs)("div",{className:"card mb-0",children:[(0,n.jsxs)("div",{className:"flex justify-content-between mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"block text-500 font-medium mb-3",children:"Machine Server"}),(0,n.jsx)("div",{className:"text-900 font-medium text-xl "+(R&&w?(null==M?void 0:M.status)==="CONNECTED"?"text-green-600":(null==M?void 0:M.status)==="CONNECTING"?"animate-pulse-fast text-yellow-500":"animate-pulse text-red-600":"animate-pulse text-red-600"),children:R?null!=w?w:"Unknown":"Disconnected"})]}),(0,n.jsx)("div",{className:"flex align-items-center justify-content-center bg-blue-100 border-round",style:{width:"2.5rem",height:"2.5rem"},children:(0,n.jsx)("i",{className:"pi pi-desktop text-blue-500 text-xl"})})]}),(0,n.jsx)(o.Z,{date:F})]})}),(0,n.jsx)("div",{className:"col-12 lg:col-6 xl:col-3",children:(0,n.jsxs)("div",{className:"card mb-0",children:[(0,n.jsxs)("div",{className:"flex justify-content-between mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"block text-500 font-medium mb-3",children:"Hostname"}),(0,n.jsx)("div",{className:"text-900 font-medium text-xl "+(R&&w&&(null==M?void 0:M.hostname)?(null==M?void 0:M.status)==="CONNECTED"?"text-green-600":(null==M?void 0:M.status)==="CONNECTING"?"animate-pulse-fast text-yellow-500":"animate-pulse text-red-600":"animate-pulse text-red-600"),children:R&&null!==(e=null==M?void 0:M.hostname)&&void 0!==e?e:"Unknown"})]}),(0,n.jsx)("div",{className:"flex align-items-center justify-content-center bg-blue-100 border-round",style:{width:"2.5rem",height:"2.5rem"},children:(0,n.jsx)("i",{className:"pi pi-address-book text-blue-500 text-xl"})})]}),(0,n.jsx)(o.Z,{date:F})]})}),(0,n.jsx)("div",{className:"col-12 lg:col-6 xl:col-3",children:(0,n.jsxs)("div",{className:"card mb-0",children:[(0,n.jsxs)("div",{className:"flex justify-content-between mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"block text-500 font-medium mb-3",children:"IP Address"}),(0,n.jsx)("div",{className:"text-900 font-medium text-xl "+(R&&w&&(null==M?void 0:M.address)?(null==M?void 0:M.status)==="CONNECTED"?"text-green-600":(null==M?void 0:M.status)==="CONNECTING"?"animate-pulse-fast text-yellow-500":"animate-pulse text-red-600":"animate-pulse text-red-600"),children:R&&null!==(t=null==M?void 0:M.address)&&void 0!==t?t:"Unknown"})]}),(0,n.jsx)("div",{className:"flex align-items-center justify-content-center bg-blue-100 border-round",style:{width:"2.5rem",height:"2.5rem"},children:(0,n.jsx)("i",{className:"pi pi-map-marker text-blue-500 text-xl"})})]}),(0,n.jsx)(o.Z,{date:F})]})}),(0,n.jsx)("div",{className:"col-12",children:(0,n.jsx)("div",{className:"card mb-0",children:(0,n.jsxs)(i.w,{selectionMode:"single",onSelectionChange:e=>{var t,s;if(null===(s=e.value)||void 0===s?void 0:null===(t=s.permissions)||void 0===t?void 0:t.startsWith("d")){let t=e.value.directory;j.replace("/device/files?server=".concat(w,"&directory=")+t+"".concat(t.endsWith("/")?"":"/").concat(e.value.name))}},showGridlines:!1,emptyMessage:(0,x.Z)({message:O&&(null!=D?D:[]).length>0?"Loading resources":O?"Requesting resources":R?(null==M?void 0:M.exists)?(null==M?void 0:M.status)!=="CONNECTED"?"Connecting to machine":"No resources found":"Machine not running XCASTER":"Connecting to backend",speed:(null==M?void 0:M.status)==="CONNECTING"?"fast":"normal"}),value:!O&&0!==(null!=D?D:[]).length&&R&&(null==M?void 0:M.status)==="CONNECTED"&&(null==M?void 0:M.exists)?D:[],paginator:!0,rows:5,rowsPerPageOptions:[5,10,25,50,75],tableStyle:{minWidth:"50rem"},paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} to {last} of {totalRecords}",paginatorLeft:()=>(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)(v.c,{model:null==S?void 0:S.split("/").filter(e=>e).map((e,t,s)=>{let n=s.slice(0,t+1).join("/");return{label:e,disabled:S==="/"+n,command:()=>{j.replace("/device/files?server=".concat(w,"&directory=/").concat(n))}}}),home:{icon:"pi pi-home",disabled:"/"===S,command(e){j.replace("/device/files?server=".concat(w,"&directory=/"))}}})}),paginatorRight:()=>(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)(p.z,{disabled:!R||(null==M?void 0:M.status)!=="CONNECTED",loading:O,type:"button",icon:"pi pi-upload",text:!0,onClick:()=>{q(50),G(!0)}}),(0,n.jsx)(p.z,{disabled:!R||(null==M?void 0:M.status)!=="CONNECTED",loading:O,type:"button",icon:"pi pi-refresh "+(O&&"pi-spin"),text:!0,onClick:Y})]}),children:[(0,n.jsx)(c.s,{filter:!0,field:"name",frozen:!0,header:"Name",style:{width:"25%"}}),(0,n.jsx)(c.s,{field:"size",header:"Size",style:{width:"25%"}}),(0,n.jsx)(c.s,{field:"date",header:"Date",style:{width:"25%"}}),(0,n.jsx)(c.s,{field:"permissions",header:"Permissions",style:{width:"25%"}}),(0,n.jsx)(c.s,{header:"Manage",body:e=>{var t;return(0,n.jsx)(p.z,{loading:O,disabled:!R||(null==M?void 0:M.status)!=="CONNECTED",icon:"pi "+((null===(t=e.permissions)||void 0===t?void 0:t.startsWith("d"))?"pi-folder-open":"pi-download"),text:!0,onClick:()=>{var t,n;(null==e?void 0:null===(t=e.permissions)||void 0===t?void 0:t.startsWith("d"))?(T(!0),j.replace("/device/files?server=".concat(w,"&directory=")+S+"".concat(S.endsWith("/")?"":"/").concat(e.name))):(null==e?void 0:null===(n=e.permissions)||void 0===n?void 0:n.startsWith("-"))&&((null==e?void 0:e.name)?et(e.name):s.current.show({severity:"error",summary:"Name Not Found!",detail:"The filename does not exist!"}))}})}})]})})})]})}},7389:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var n=s(9268),l=s(6006);let r=e=>{let t=new Date-new Date(e),s=Math.floor(t/1e3),n=Math.floor(s/31536e3);return n>1?"".concat(n," years ago"):(n=Math.floor(s/2592e3))>1?"".concat(n," months ago"):(n=Math.floor(s/86400))>1?"".concat(n," days ago"):(n=Math.floor(s/3600))>1?"".concat(n," hours ago"):(n=Math.floor(s/60))>1?"".concat(n," minutes ago"):s>=1?"".concat(s," seconds ago"):t>1?"".concat(t," milliseconds ago"):"just now"};var o=e=>{let{date:t,className:s}=e,[o,a]=(0,l.useState)("");return(0,l.useEffect)(()=>{a(r(t));let e=setInterval(()=>{a(r(t))},100);return()=>clearInterval(e)},[t]),(0,n.jsx)("span",{className:s,children:o})}},2469:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var n=s(9268),l=s(7690),r=s(6006),o=s(9497),a=s.n(o);let i=e=>{let{delay:t=500}=e,[s,l]=(0,r.useState)("");return(0,r.useEffect)(()=>{let e=setInterval(()=>{l(e=>{switch(e){case"":return".";case".":return"..";case"..":return"...";default:return""}})},t);return()=>clearInterval(e)},[t]),(0,n.jsx)("span",{children:s})};i.propTypes={delay:a().number};let c=e=>{let{message:t,speed:s="normal",dotSpeed:r=400,...o}=e;return(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,n.jsx)(l.E,{...o,className:"fast"===s?"animate-pulse-fast":"animate-pulse",alt:"XBOT ROBOTICS LOGO",src:"/images/logo/logo.png"}),t&&(0,n.jsxs)("p",{className:"font-bold",children:[null!=t?t:"Loading",(0,n.jsx)(i,{delay:r})]})]})};c.propType={message:a().number};var d=c},7537:function(e,t,s){"use strict";s.r(t),s.d(t,{WebSocketProvider:function(){return o},WebsocketContext:function(){return r}});var n=s(9268),l=s(6006);let r=(0,l.createContext)({}),o=e=>{let{children:t,url:s}=e,[o,a]=(0,l.useState)(!1),[i,c]=(0,l.useState)(new Date),d=(0,l.useRef)(null);return(0,l.useEffect)(()=>((function e(){console.log("Connecting to websocket"),d.current=new WebSocket(s),d.current.onopen=()=>{a(!0)},d.current.onclose=()=>(a(!1),console.log("Disconnected from websocket."),e()),d.current.onerror=e=>{console.error("WebSocket Error: ",e),d.current.close(),a(!1)}})(),()=>{d.current&&d.current.close()}),[s]),(0,l.useEffect)(()=>{c(new Date)},[o]),(0,n.jsx)(r.Provider,{value:{isConnected:o,lastConnectionUpdate:i,sendMessageAndWaitForCondition:function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1500;return o?(d.current.send(JSON.stringify(e)),new Promise((e,n)=>{let l=s=>{let n=JSON.parse(s.data);if(t(n)){d.current.removeEventListener("message",l),clearTimeout(r);let t=n.message;n.message=JSON.parse(t),e(n)}},r=setTimeout(()=>{d.current.removeEventListener("message",l),n(Error("Timeout: Condition not met within ".concat(s," ms")))},s);d.current.addEventListener("message",l)})):Promise.reject(Error("WebSocket is not connected"))},sendMessageTillCondition:(e,t)=>{if(!o)throw Error("WebSocket is not connected");d.current.send(JSON.stringify(e));let s=e=>{let n=JSON.parse(e.data);t(n)&&d.current.removeEventListener("message",s)};d.current.addEventListener("message",s)},listenTillCondition:e=>o?new Promise(t=>{let s=n=>{let l=JSON.parse(n.data);e(l)&&(d.current.removeEventListener("message",s),t(l))};d.current.addEventListener("message",s)}):Promise.reject(Error("WebSocket is not connected")),socket:d,sendMessage:e=>{if(!o)return Error("WebSocket is not connected");d.current.send(JSON.stringify(e))}},children:t})}}},function(e){e.O(0,[8123,434,6878,6789,8285,9933,845,439,6966,9217,4046,769,1196,4278,9253,5769,1744],function(){return e(e.s=2962)}),_N_E=e.O()}]);
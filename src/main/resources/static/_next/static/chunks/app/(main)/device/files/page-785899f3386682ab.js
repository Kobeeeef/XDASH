(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2823],{2962:function(e,t,s){Promise.resolve().then(s.bind(s,330))},330:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var n=s(9268),l=s(6006),r=s(7537),a=s(7389),i=s(3429),o=s(8176),c=s(8298),d=s(4046),u=s(6008),m=s(4390),p=s(3702),x=s(2469),h=s(4319),f=s(9424),v=s(1196),g=s(9009),b=()=>{var e,t;let s=(0,l.useRef)(null),b=(0,u.useSearchParams)(),j=(0,u.useRouter)(),N=b.get("server"),[y,w]=(0,l.useState)(null),E=b.get("directory"),[C,S]=(0,l.useState)(null),[k,O]=(0,l.useState)(!1),[T,D]=(0,l.useState)([]),{isConnected:P,lastConnectionUpdate:I,sendMessageAndWaitForCondition:R,listenTillCondition:L}=(0,l.useContext)(r.WebsocketContext),[M,z]=(0,l.useState)(new Date),[W,F]=(0,l.useState)({}),[U,A]=(0,l.useState)(!1),[J,V]=(0,l.useState)(!1),[G,Z]=(0,l.useState)(null),[_,H]=(0,l.useState)(0),[X,B]=(0,l.useState)(!1);function q(){if(P&&y&&!X){if(!C){j.replace("/device/files?server=".concat(y,"&directory=/"));return}O(!0),B(!0),R({type:"DEVICE-SCP-LIST",message:JSON.stringify({server:y,directory:C})},e=>"DEVICE-SCP-LIST"===e.type,5e3).then(e=>{if(e.message.success){let t=JSON.parse(e.message.files);D(t)}O(!1),B(!1)}).catch(e=>{console.log(e),O(!1),B(!1)})}}(0,l.useEffect)(()=>{N&&w(N),E&&S(E)},[N,E,P]),(0,l.useEffect)(()=>{let e=setInterval(()=>{P&&!X&&R({type:"DEVICE-DATA",message:y},e=>"DEVICE-DATA"===e.type).then(e=>{var t;(null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.exists)?(F(e.message),A(!1)):(A(!0),F({}))}).catch(()=>{})},250);return()=>clearInterval(e)},[P,y,X]),(0,l.useEffect)(()=>{q()},[y,C,P]);let K=(0,l.useRef)(null),Q=async e=>{let{files:t}=e,n="10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)),l=new FormData;l.append("server",y),l.append("directory",C),l.append("id",n),Array.from(t).forEach(e=>{l.append("files[]",e)}),O(!0),B(!0);try{let e="TRANSFER-PROGRESS-"+n;L(t=>{var n,l,r;if((null==t?void 0:t.type)===e){let e=JSON.parse(t.message);return H(null!==(l=null==e?void 0:null===(n=e.percentage)||void 0===n?void 0:n.toFixed(0))&&void 0!==l?l:0),Z(null!==(r=null==e?void 0:e.message)&&void 0!==r?r:"Unknown"),null!=e&&!!e.finished&&(s.current.show({severity:"success",summary:"Success",detail:"Files uploaded successfully"}),q(),B(!1),!0)}});let t=new XMLHttpRequest;t.open("POST","/api/upload",!0),t.upload.onprogress=e=>{if(e.lengthComputable){let t=e.loaded/e.total*100;H(t.toFixed(0)),Z("Uploading to backend: ".concat(t.toFixed(0),"%"))}},t.onload=()=>{t.status>=200&&t.status<300?(H(100),Z("Upload complete...")):(H(0),Z("Upload failed to backend"),s.current.show({severity:"error",summary:"Error",detail:"File upload failed"}))},t.onerror=()=>{H(0),Z("Upload error"),s.current.show({severity:"error",summary:"Error",detail:"File upload failed due to a network error"})},t.send(l)}catch(e){O(!1),B(!1),console.error("Upload error:",e),s.current.show({severity:"error",summary:"Error",detail:e.message})}},Y=(e,t)=>{H(0),t()};return(0,n.jsxs)("div",{className:"grid fadeIn",children:[(0,n.jsx)(d.F,{ref:s}),(0,n.jsx)(m.V,{header:"Machine Discovery Failed",modal:!1,visible:U,position:"top-right",style:{width:"50vw"},onHide:()=>{U&&A(!1)},closable:!1,draggable:!0,resizable:!1,children:(0,n.jsxs)("p",{className:"m-0",children:["The machine with the server name ",(0,n.jsx)("strong",{children:y})," was not found on the network running XCASTER. Please check your network connection, verify the machine is on and try again later."]})}),(0,n.jsx)(m.V,{maximizable:!0,style:{width:"80vw",height:"60vh"},visible:J,resizable:!1,onHide:()=>{V(!1)},children:(0,n.jsxs)("div",{children:[(0,n.jsx)(f.u,{target:".custom-choose-btn",content:"Choose",position:"bottom"}),(0,n.jsx)(f.u,{target:".custom-upload-btn",content:"Upload",position:"bottom"}),(0,n.jsx)(f.u,{target:".custom-cancel-btn",content:"Clear",position:"bottom"}),(0,n.jsx)(v.p,{disabled:X||k,ref:K,multiple:!0,maxFileSize:1e8,customUpload:!0,uploadHandler:Q,onClear:()=>{H(0)},headerTemplate:e=>{let{className:t,chooseButton:s,uploadButton:l,cancelButton:r}=e;return(0,n.jsxs)("div",{className:t,style:{backgroundColor:"transparent",display:"flex",alignItems:"center"},children:[s,l,r]})},itemTemplate:(e,t)=>(0,n.jsxs)("div",{className:"flex align-items-center flex-wrap",children:[(0,n.jsx)("div",{className:"flex align-items-center",style:{width:"40%"},children:(0,n.jsxs)("span",{className:"flex flex-column text-left ml-3",children:[e.name,(0,n.jsx)("small",{children:new Date().toLocaleDateString()})]})}),(0,n.jsx)(i.V,{value:t.formatSize,severity:"warning",className:"px-3 py-2"}),(0,n.jsx)(p.z,{type:"button",icon:"pi pi-times",className:"p-button-outlined p-button-rounded p-button-danger ml-auto",onClick:()=>Y(e,t.onRemove)})]}),emptyTemplate:()=>(0,n.jsxs)("div",{className:"flex align-items-center flex-column",children:[(0,n.jsx)("i",{className:"pi pi-image mt-3 p-5",style:{fontSize:"5em",borderRadius:"50%",backgroundColor:"var(--surface-b)",color:"var(--surface-d)"}}),(0,n.jsx)("span",{style:{fontSize:"1.2em",color:"var(--text-color-secondary)"},className:"my-5",children:"Drag and drop files here"})]}),chooseOptions:{icon:"pi pi-fw pi-images",iconOnly:!0,className:"custom-choose-btn p-button-rounded p-button-outlined"},uploadOptions:{icon:"pi pi-fw pi-cloud-upload",iconOnly:!0,className:"custom-upload-btn p-button-success p-button-rounded p-button-outlined"},cancelOptions:{icon:"pi pi-fw pi-times",iconOnly:!0,className:"custom-cancel-btn p-button-danger p-button-rounded p-button-outlined"}}),_>0&&(0,n.jsxs)("div",{style:{marginTop:"20px"},children:[(0,n.jsx)(g.k,{value:_}),(0,n.jsx)("div",{children:G})]})]})}),(0,n.jsx)("div",{className:"col-12 lg:col-6 sm:col-4 xl:col-3",children:(0,n.jsxs)("div",{className:"card mb-0",children:[(0,n.jsxs)("div",{className:"flex justify-content-between mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"block text-500 font-medium mb-3",children:"Backend Status"}),(0,n.jsx)("div",{className:"text-900 font-medium text-xl "+(P?"text-green-600":"text-red-600 animate-pulse"),children:P?"Connected":"Disconnected"})]}),(0,n.jsx)("div",{className:"flex align-items-center justify-content-center bg-blue-100 border-round",style:{width:"2.5rem",height:"2.5rem"},children:(0,n.jsx)("i",{className:"pi pi-chevron-circle-up text-blue-500 text-xl"})})]}),(0,n.jsx)(a.Z,{date:I})]})}),(0,n.jsx)("div",{className:"col-12 lg:col-6 sm:col-4 xl:col-3",children:(0,n.jsxs)("div",{className:"card mb-0",children:[(0,n.jsxs)("div",{className:"flex justify-content-between mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"block text-500 font-medium mb-3",children:"Machine Server"}),(0,n.jsx)("div",{className:"text-900 font-medium text-xl "+(P&&y?(null==W?void 0:W.status)==="CONNECTED"?"text-green-600":(null==W?void 0:W.status)==="CONNECTING"?"animate-pulse-fast text-yellow-500":"animate-pulse text-red-600":"animate-pulse text-red-600"),children:P?null!=y?y:"Unknown":"Disconnected"})]}),(0,n.jsx)("div",{className:"flex align-items-center justify-content-center bg-blue-100 border-round",style:{width:"2.5rem",height:"2.5rem"},children:(0,n.jsx)("i",{className:"pi pi-desktop text-blue-500 text-xl"})})]}),(0,n.jsx)(a.Z,{date:M})]})}),(0,n.jsx)("div",{className:"col-12 lg:col-6 xl:col-3",children:(0,n.jsxs)("div",{className:"card mb-0",children:[(0,n.jsxs)("div",{className:"flex justify-content-between mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"block text-500 font-medium mb-3",children:"Hostname"}),(0,n.jsx)("div",{className:"text-900 font-medium text-xl "+(P&&y&&(null==W?void 0:W.hostname)?(null==W?void 0:W.status)==="CONNECTED"?"text-green-600":(null==W?void 0:W.status)==="CONNECTING"?"animate-pulse-fast text-yellow-500":"animate-pulse text-red-600":"animate-pulse text-red-600"),children:P&&null!==(e=null==W?void 0:W.hostname)&&void 0!==e?e:"Unknown"})]}),(0,n.jsx)("div",{className:"flex align-items-center justify-content-center bg-blue-100 border-round",style:{width:"2.5rem",height:"2.5rem"},children:(0,n.jsx)("i",{className:"pi pi-address-book text-blue-500 text-xl"})})]}),(0,n.jsx)(a.Z,{date:M})]})}),(0,n.jsx)("div",{className:"col-12 lg:col-6 xl:col-3",children:(0,n.jsxs)("div",{className:"card mb-0",children:[(0,n.jsxs)("div",{className:"flex justify-content-between mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"block text-500 font-medium mb-3",children:"IP Address"}),(0,n.jsx)("div",{className:"text-900 font-medium text-xl "+(P&&y&&(null==W?void 0:W.address)?(null==W?void 0:W.status)==="CONNECTED"?"text-green-600":(null==W?void 0:W.status)==="CONNECTING"?"animate-pulse-fast text-yellow-500":"animate-pulse text-red-600":"animate-pulse text-red-600"),children:P&&null!==(t=null==W?void 0:W.address)&&void 0!==t?t:"Unknown"})]}),(0,n.jsx)("div",{className:"flex align-items-center justify-content-center bg-blue-100 border-round",style:{width:"2.5rem",height:"2.5rem"},children:(0,n.jsx)("i",{className:"pi pi-map-marker text-blue-500 text-xl"})})]}),(0,n.jsx)(a.Z,{date:M})]})}),(0,n.jsx)("div",{className:"col-12",children:(0,n.jsx)("div",{className:"card mb-0",children:(0,n.jsxs)(o.w,{showGridlines:!1,emptyMessage:(0,x.Z)({message:k&&(null!=T?T:[]).length>0?"Loading resources":k?"Requesting resources":P?(null==W?void 0:W.exists)?(null==W?void 0:W.status)!=="CONNECTED"?"Connecting to machine":"No resources found":"Machine not running XCASTER":"Connecting to backend",speed:(null==W?void 0:W.status)==="CONNECTING"?"fast":"normal"}),value:!k&&0!==(null!=T?T:[]).length&&P&&(null==W?void 0:W.status)==="CONNECTED"&&(null==W?void 0:W.exists)?T:[],paginator:!0,rows:5,rowsPerPageOptions:[5,10,25,50,75],tableStyle:{minWidth:"50rem"},paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} to {last} of {totalRecords}",paginatorLeft:()=>(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)(h.c,{model:null==C?void 0:C.split("/").filter(e=>e).map((e,t,s)=>{let n=s.slice(0,t+1).join("/");return{label:e,disabled:C==="/"+n,command:()=>{j.replace("/device/files?server=".concat(y,"&directory=/").concat(n))}}}),home:{icon:"pi pi-home",disabled:"/"===C,command(e){j.replace("/device/files?server=".concat(y,"&directory=/"))}}})}),paginatorRight:()=>(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)(p.z,{disabled:!P||(null==W?void 0:W.status)!=="CONNECTED",loading:k,type:"button",icon:"pi pi-upload",text:!0,onClick:()=>{H(0),V(!0)}}),(0,n.jsx)(p.z,{disabled:!P||(null==W?void 0:W.status)!=="CONNECTED",loading:k,type:"button",icon:"pi pi-refresh "+(k&&"pi-spin"),text:!0,onClick:q})]}),children:[(0,n.jsx)(c.s,{filter:!0,field:"name",frozen:!0,header:"Name",style:{width:"25%"}}),(0,n.jsx)(c.s,{field:"size",header:"Size",style:{width:"25%"}}),(0,n.jsx)(c.s,{field:"date",header:"Date",style:{width:"25%"}}),(0,n.jsx)(c.s,{field:"permissions",header:"Permissions",style:{width:"25%"}}),(0,n.jsx)(c.s,{header:"Manage",body:e=>{var t;return(0,n.jsx)(p.z,{loading:k,disabled:!P||(null==W?void 0:W.status)!=="CONNECTED",icon:"pi "+((null===(t=e.permissions)||void 0===t?void 0:t.startsWith("d"))?"pi-folder-open":"pi-download"),text:!0,onClick:()=>{var t;(null==e?void 0:null===(t=e.permissions)||void 0===t?void 0:t.startsWith("d"))&&(O(!0),j.replace("/device/files?server=".concat(y,"&directory=")+C+"".concat(C.endsWith("/")?"":"/").concat(e.name)))}})}})]})})})]})}},7389:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var n=s(9268),l=s(6006);let r=e=>{let t=new Date-new Date(e),s=Math.floor(t/1e3),n=Math.floor(s/31536e3);return n>1?"".concat(n," years ago"):(n=Math.floor(s/2592e3))>1?"".concat(n," months ago"):(n=Math.floor(s/86400))>1?"".concat(n," days ago"):(n=Math.floor(s/3600))>1?"".concat(n," hours ago"):(n=Math.floor(s/60))>1?"".concat(n," minutes ago"):s>=1?"".concat(s," seconds ago"):t>1?"".concat(t," milliseconds ago"):"just now"};var a=e=>{let{date:t,className:s}=e,[a,i]=(0,l.useState)("");return(0,l.useEffect)(()=>{i(r(t));let e=setInterval(()=>{i(r(t))},100);return()=>clearInterval(e)},[t]),(0,n.jsx)("span",{className:s,children:a})}},2469:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var n=s(9268),l=s(7690),r=s(6006),a=s(9497),i=s.n(a);let o=e=>{let{delay:t=500}=e,[s,l]=(0,r.useState)("");return(0,r.useEffect)(()=>{let e=setInterval(()=>{l(e=>{switch(e){case"":return".";case".":return"..";case"..":return"...";default:return""}})},t);return()=>clearInterval(e)},[t]),(0,n.jsx)("span",{children:s})};o.propTypes={delay:i().number};let c=e=>{let{message:t,speed:s="normal",dotSpeed:r=400,...a}=e;return(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,n.jsx)(l.E,{...a,className:"fast"===s?"animate-pulse-fast":"animate-pulse",alt:"XBOT ROBOTICS LOGO",src:"/images/logo/logo.png"}),t&&(0,n.jsxs)("p",{className:"font-bold",children:[null!=t?t:"Loading",(0,n.jsx)(o,{delay:r})]})]})};c.propType={message:i().number};var d=c},7537:function(e,t,s){"use strict";s.r(t),s.d(t,{WebSocketProvider:function(){return a},WebsocketContext:function(){return r}});var n=s(9268),l=s(6006);let r=(0,l.createContext)({}),a=e=>{let{children:t,url:s}=e,[a,i]=(0,l.useState)(!1),[o,c]=(0,l.useState)(new Date),d=(0,l.useRef)(null);return(0,l.useEffect)(()=>((function e(){console.log("Connecting to websocket"),d.current=new WebSocket(s),d.current.onopen=()=>{i(!0)},d.current.onclose=()=>(i(!1),console.log("Disconnected from websocket."),e()),d.current.onerror=e=>{console.error("WebSocket Error: ",e),d.current.close(),i(!1)}})(),()=>{d.current&&d.current.close()}),[s]),(0,l.useEffect)(()=>{c(new Date)},[a]),(0,n.jsx)(r.Provider,{value:{isConnected:a,lastConnectionUpdate:o,sendMessageAndWaitForCondition:function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1500;return a?(d.current.send(JSON.stringify(e)),new Promise((e,n)=>{let l=s=>{let n=JSON.parse(s.data);if(t(n)){d.current.removeEventListener("message",l),clearTimeout(r);let t=n.message;n.message=JSON.parse(t),e(n)}},r=setTimeout(()=>{d.current.removeEventListener("message",l),n(Error("Timeout: Condition not met within ".concat(s," ms")))},s);d.current.addEventListener("message",l)})):Promise.reject(Error("WebSocket is not connected"))},sendMessageTillCondition:(e,t)=>{if(!a)throw Error("WebSocket is not connected");d.current.send(JSON.stringify(e));let s=e=>{let n=JSON.parse(e.data);t(n)&&d.current.removeEventListener("message",s)};d.current.addEventListener("message",s)},listenTillCondition:e=>a?new Promise(t=>{let s=n=>{let l=JSON.parse(n.data);e(l)&&(d.current.removeEventListener("message",s),t(l))};d.current.addEventListener("message",s)}):Promise.reject(Error("WebSocket is not connected")),socket:d,sendMessage:e=>{if(!a)return Error("WebSocket is not connected");d.current.send(JSON.stringify(e))}},children:t})}}},function(e){e.O(0,[8123,434,6878,6789,8285,9933,845,2087,7136,9217,4046,769,1196,4278,9253,5769,1744],function(){return e(e.s=2962)}),_N_E=e.O()}]);